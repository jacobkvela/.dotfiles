# Use bash as default
set -g default-shell /bin/bash

# Enable 256-color and true-color (24-bit) support in tmux
set -g default-terminal "screen-256color" # Set terminal type for 256-color support
set -ga terminal-overrides ",*256col*:Tc" # Override to enable true-color for compatible terminals

# General
set -g set-clipboard on         # Use system clipboard
set -g detach-on-destroy off    # Don't exit from tmux when closing a session
set -g escape-time 0            # Remove delay for exiting insert mode with ESC in Neovim
set -g history-limit 1000000    # Increase history size (from 2,000)
set -g mouse on                 # Enable mouse support
set -g status-interval 3        # Update the status bar every 3 seconds (default: 15 seconds)
set -g allow-passthrough on     # Allow programs in the pane to bypass tmux (e.g. for image preview)
set -g status-position bottom

# Set prefix key
unbind C-b              # Unbind the default prefix key
set -g prefix C-Space   # Set new prefix key to Ctrl+Space

# Refresh tmux config with r
unbind r
bind r source-file ~/.config/tmux/tmux.conf \; display-message "Config reloaded!"

# Split horizontally in CWD with \
unbind %
bind \\ split-window -h -c "#{pane_current_path}"

# Split vertically in CWD with -
unbind \"
bind - split-window -v -c "#{pane_current_path}"

# New window in same path
bind c new-window -c "#{pane_current_path}"

# Use vim arrow keys to resize
bind -r j resize-pane -D 5
bind -r k resize-pane -U 5
bind -r l resize-pane -R 5
bind -r h resize-pane -L 5

# Use m key to maximize pane
bind -r m resize-pane -Z

# Enable vi mode to allow us to use vim keys to move around in copy mode (Prefix + [ places us in copy mode)
set-window-option -g mode-keys vi

# Start selecting text with "v"
bind-key -T copy-mode-vi 'v' send -X begin-selection

# Copy text with "y" - Fixed for Linux
# For X11 (most desktop environments):

#bind -T copy-mode-vi 'y' send-keys -X copy-pipe-and-cancel "xclip -selection clipboard"

# For Wayland (uncomment if using Wayland):
 bind -T copy-mode-vi 'y' send-keys -X copy-pipe-and-cancel "wl-copy"

# Copy on mouse drag and release - Wayland
bind -T copy-mode-vi MouseDragEnd1Pane send-keys -X copy-pipe-and-cancel "wl-copy"

# Paste yanked text with "Prefix + P" ("Prefix + p" goes to previous window)
bind P paste-buffer

# ncmpcpp popup (Ctrl-Space + m)
bind-key M display-popup -E -w 80% -h 80% "ncmpcpp"

# Don't exit copy mode when dragging with mouse
unbind -T copy-mode-vi MouseDragEnd1Pane

# Start windows and panes at 1, not 0
set -g base-index 1
set -g pane-base-index 1
set -g renumber-windows on # Automatically renumber windows when one is closed

# Better window naming
set -g automatic-rename on
set -g automatic-rename-format '#{b:pane_current_path}'

# Longer display time for pane numbers (Prefix + q)
set -g display-panes-time 2000

# Activity monitoring
setw -g monitor-activity on
set -g visual-activity off

# Better mouse scrolling
set -g @scroll-speed-num-lines-per-scroll 2

#==========================================================
# GRUVBOX THEME
#==========================================================

# Gruvbox color palette
# Background colors
BG0='#282828'    # Hard dark
BG1='#3c3836'    # Medium dark
BG2='#504945'    # Soft dark
BG3='#665c54'    #

# Foreground colors
FG0='#fbf1c7'    # Hard light
FG1='#ebdbb2'    # Medium light
FG4='#a89984'    # Gray

# Accent colors
RED='#cc241d'
GREEN='#98971a'
YELLOW='#d79921'
BLUE='#458588'
PURPLE='#b16286'
AQUA='#689d6a'
ORANGE='#d65d0e'

# Bright variants
BRIGHT_RED='#fb4934'
BRIGHT_GREEN='#b8bb26'
BRIGHT_YELLOW='#fabd2f'
BRIGHT_BLUE='#83a598'
BRIGHT_PURPLE='#d3869b'
BRIGHT_AQUA='#8ec07c'
BRIGHT_ORANGE='#fe8019'

#==========================================================
# STATUS BAR
#==========================================================

# Status bar colors
set -g status-style bg='#282828',fg='#ebdbb2'

# Status left (session name)
set -g status-left-length 40
set -g status-left "#[fg=#282828,bg=#b8bb26,bold] #S #[fg=#b8bb26,bg=#282828]"

# Status right (date and time)
set -g status-right-length 100
set -g status-right "#[fg=#504945,bg=#282828]#[fg=#ebdbb2,bg=#504945] %Y-%m-%d #[fg=#3c3836,bg=#504945]#[fg=#ebdbb2,bg=#3c3836] %H:%M #[fg=#b8bb26,bg=#3c3836]#[fg=#282828,bg=#b8bb26,bold] #H "

# Window status
set -g window-status-format "#[fg=#282828,bg=#504945]#[fg=#ebdbb2,bg=#504945] #I #[fg=#ebdbb2,bg=#504945]#W #[fg=#504945,bg=#282828]"
set -g window-status-current-format "#[fg=#282828,bg=#fabd2f]#[fg=#282828,bg=#fabd2f,bold] #I #[fg=#282828,bg=#fabd2f,bold]#W #[fg=#fabd2f,bg=#282828]"

# Center window list
set -g status-justify left

#==========================================================
# PANES
#==========================================================

# Pane borders
set -g pane-border-style fg='#504945'
set -g pane-active-border-style fg='#b8bb26'

# Pane number display
set -g display-panes-active-colour '#b8bb26'
set -g display-panes-colour '#504945'

#==========================================================
# MESSAGES
#==========================================================

# Command/message line colors
set -g message-style bg='#fabd2f',fg='#282828',bold
set -g message-command-style bg='#fabd2f',fg='#282828',bold

# Mode (copy mode, etc)
set -g mode-style bg='#fabd2f',fg='#282828',bold

#==========================================================
# CLOCK
#==========================================================

# Clock color (Prefix + t)
set -g clock-mode-colour '#b8bb26'
set -g clock-mode-style 24

#==========================================================
# NOTES
#==========================================================
# Gruvbox Dark theme for tmux
# Matches your vim gruvbox colorscheme
#
# Main colors:
# - Green (#b8bb26) - Active elements, accents
# - Yellow (#fabd2f) - Current window, highlights
# - Dark Gray (#282828) - Background
# - Light Gray (#ebdbb2) - Foreground text
#
# Reload config: Ctrl+Space r
#==========================================================

#==========================================================
# TMUX POPUPS - Using Your Existing Tools
# Add these to the end of your ~/.config/tmux/tmux.conf
#==========================================================

# You already have ncmpcpp popup (Ctrl+Space M)

#==========================================================
# SYSTEM MONITOR - htop (Ctrl+Space H)
#==========================================================
bind-key H display-popup -E -w 90% -h 90% "htop"

#==========================================================
# GIT STATUS (Ctrl+Space G)
#==========================================================
# Quick git status in current directory
# Git Status
bind-key G display-popup -E -w 80% -h 80% -d "#{pane_current_path}" \
    "git -c color.status=always status 2>/dev/null || echo 'Not a git repository'; echo ''; echo 'Press any key to close...'; read -n 1"

#==========================================================
# GIT LOG (Ctrl+Space L)
#==========================================================
# Pretty git log
bind-key L display-popup -E -w 90% -h 90% -d "#{pane_current_path}" \
    "git log --oneline --graph --decorate --all --color=always | less -R"

#==========================================================
# CALENDAR (Ctrl+Space C)
#==========================================================
# 3-month calendar
bind-key C display-popup -E -w 40% -h 40% "cal -3"

#==========================================================
# QUICK NOTES (Ctrl+Space N)
#==========================================================
# Vim scratchpad
bind-key N display-popup -E -w 80% -h 80% "vim ~/scratch.md"

#==========================================================
# SYSTEM INFO (Ctrl+Space I)
#==========================================================
bind-key I display-popup -E -w 70% -h 70% "sh -c '\
echo \"╔══════════════════════════════════════╗\"; \
echo \"║         SYSTEM INFORMATION           ║\"; \
echo \"╚══════════════════════════════════════╝\"; \
echo \"\"; \
echo \"Hostname:  $(hostname)\"; \
echo \"Uptime:    $(uptime -p)\"; \
echo \"Kernel:    $(uname -r)\"; \
echo \"\"; \
echo \"════════════ DISK USAGE ══════════════\"; \
df -h / /home 2>/dev/null | tail -n +2; \
echo \"\"; \
echo \"════════════ MEMORY ══════════════════\"; \
free -h | grep -v Swap; \
echo \"\"; \
echo \"════════════ CPU ═════════════════════\"; \
lscpu | grep \"Model name\\|CPU(s)\\|Thread\"; \
echo \"\"; \
echo \"Press any key to close...\"; \
read -n 1'"

#==========================================================
# FILE FINDER (Ctrl+Space F) - Using find + fzf
#==========================================================
# Find and open files with vim
bind-key F display-popup -E -w 90% -h 90% -d "#{pane_current_path}" \
    "find . -type f 2>/dev/null | fzf --preview 'bat --color=always {}' --bind 'enter:become(vim {})'"

#==========================================================
# GREP SEARCH (Ctrl+Space S) - Using ripgrep + fzf
#==========================================================
# Search file contents
bind-key S display-popup -E -w 90% -h 90% -d "#{pane_current_path}" \
    "rg --color=always --line-number --no-heading --smart-case '' | \
         fzf --ansi --delimiter ':' --preview 'bat --color=always {1} --highlight-line {2}' --preview-window '+{2}/2'"

#==========================================================
# CALCULATOR (Ctrl+Space =)
#==========================================================
# Python calculator (q to quit)
bind-key = display-popup -E -w 50% -h 50% "python3 -q"

#==========================================================
# MAN PAGES (Ctrl+Space m)
#==========================================================
# Search and view man pages
bind-key m display-popup -E -w 90% -h 90% \
    "man -k . | fzf --preview 'echo {}' --bind 'enter:become(man {1})'"

#==========================================================
# PROCESS VIEWER (Ctrl+Space P)
#==========================================================
# Interactive process list with fzf
bind-key P display-popup -E -w 90% -h 90% \
    "ps aux | fzf --header-lines=1 --preview 'echo {}' --preview-window=down:3:wrap"

#==========================================================
# TMUX KEYBINDINGS HELP (Ctrl+Space ?)
#==========================================================
# Browse all keybindings
bind-key ? display-popup -E -w 80% -h 90% "tmux list-keys | fzf"

#==========================================================
# DIRECTORY NAVIGATION (Ctrl+Space d)
#==========================================================
# Jump to recent directories
bind-key d display-popup -E -w 80% -h 80% \
    "dirs -v | fzf --bind 'enter:become(echo {})'"

#==========================================================
# PACKAGE SEARCH (Ctrl+Space /)
#==========================================================
# Search Arch packages
bind-key / display-popup -E -w 90% -h 90% \
    "pacman -Ss '' | grep --color=always -E '^[^ ]|$' | fzf --ansi"

#==========================================================
# NOTES
#==========================================================
# All popups use tools you already have:
# - vim, bat, fzf, ripgrep, htop
# - git, cal, curl, python3
# - Standard Unix tools (ps, df, free, etc.)
#
# Popup options:
#   -E                     Close on exit
#   -w 90%                 Width (percentage or pixels)
#   -h 90%                 Height (percentage or pixels)
#   -d "#{pane_current_path}"  Open in current pane's directory
#
# To close a popup: Ctrl+C or exit the program
#==========================================================
